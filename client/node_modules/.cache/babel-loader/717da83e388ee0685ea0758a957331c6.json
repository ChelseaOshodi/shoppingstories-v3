{"ast":null,"code":"// Perform a depth-first walk of a tree, ONLY doing the descent (visit)\n//\n// This uses a stack rather than recursion, so that it can handle deeply\n// nested trees without call stack overflows.  (My kingdom for proper TCO!)\n//\n// This is only used for cases where leave() is not specified.\n//\n// a\n// +-- b\n// |   +-- 1\n// |   +-- 2\n// +-- c\n//     +-- 3\n//     +-- 4\n//\n// Expect:\n// visit a\n// visit b\n// visit 1\n// visit 2\n// visit c\n// visit 3\n// visit 4\n//\n// stack.push(tree)\n// while stack not empty\n//   pop T from stack\n//   VISIT(T)\n//   get children C of T\n//   push each C onto stack\nconst depth = _ref => {\n  let {\n    visit,\n    filter,\n    getChildren,\n    tree\n  } = _ref;\n  const stack = [];\n  const seen = new Map();\n\n  const next = () => {\n    while (stack.length) {\n      const node = stack.pop();\n      const res = visitNode(node);\n\n      if (isPromise(res)) {\n        return res.then(() => next());\n      }\n    }\n\n    return seen.get(tree);\n  };\n\n  const visitNode = visitTree => {\n    if (seen.has(visitTree)) {\n      return seen.get(visitTree);\n    }\n\n    seen.set(visitTree, null);\n    const res = visit ? visit(visitTree) : visitTree;\n\n    if (isPromise(res)) {\n      const fullResult = res.then(resThen => {\n        seen.set(visitTree, resThen);\n        return kidNodes(visitTree);\n      });\n      seen.set(visitTree, fullResult);\n      return fullResult;\n    } else {\n      seen.set(visitTree, res);\n      return kidNodes(visitTree);\n    }\n  };\n\n  const kidNodes = kidTree => {\n    const kids = getChildren(kidTree, seen.get(kidTree));\n    return isPromise(kids) ? kids.then(processKids) : processKids(kids);\n  };\n\n  const processKids = kids => {\n    kids = (kids || []).filter(filter);\n    stack.push(...kids);\n  };\n\n  stack.push(tree);\n  return next();\n};\n\nconst isPromise = p => p && typeof p.then === 'function';\n\nmodule.exports = depth;","map":{"version":3,"names":["depth","visit","filter","getChildren","tree","stack","seen","Map","next","length","node","pop","res","visitNode","isPromise","then","get","visitTree","has","set","fullResult","resThen","kidNodes","kidTree","kids","processKids","push","p","module","exports"],"sources":["/Users/chelsea/Documents/0_AllCoding/shoppingstories-v3/node_modules/npm/node_modules/treeverse/lib/depth-descent.js"],"sourcesContent":["// Perform a depth-first walk of a tree, ONLY doing the descent (visit)\n//\n// This uses a stack rather than recursion, so that it can handle deeply\n// nested trees without call stack overflows.  (My kingdom for proper TCO!)\n//\n// This is only used for cases where leave() is not specified.\n//\n// a\n// +-- b\n// |   +-- 1\n// |   +-- 2\n// +-- c\n//     +-- 3\n//     +-- 4\n//\n// Expect:\n// visit a\n// visit b\n// visit 1\n// visit 2\n// visit c\n// visit 3\n// visit 4\n//\n// stack.push(tree)\n// while stack not empty\n//   pop T from stack\n//   VISIT(T)\n//   get children C of T\n//   push each C onto stack\n\nconst depth = ({\n  visit,\n  filter,\n  getChildren,\n  tree,\n}) => {\n  const stack = []\n  const seen = new Map()\n\n  const next = () => {\n    while (stack.length) {\n      const node = stack.pop()\n      const res = visitNode(node)\n      if (isPromise(res)) {\n        return res.then(() => next())\n      }\n    }\n    return seen.get(tree)\n  }\n\n  const visitNode = (visitTree) => {\n    if (seen.has(visitTree)) {\n      return seen.get(visitTree)\n    }\n\n    seen.set(visitTree, null)\n    const res = visit ? visit(visitTree) : visitTree\n    if (isPromise(res)) {\n      const fullResult = res.then(resThen => {\n        seen.set(visitTree, resThen)\n        return kidNodes(visitTree)\n      })\n      seen.set(visitTree, fullResult)\n      return fullResult\n    } else {\n      seen.set(visitTree, res)\n      return kidNodes(visitTree)\n    }\n  }\n\n  const kidNodes = (kidTree) => {\n    const kids = getChildren(kidTree, seen.get(kidTree))\n    return isPromise(kids) ? kids.then(processKids) : processKids(kids)\n  }\n\n  const processKids = (kids) => {\n    kids = (kids || []).filter(filter)\n    stack.push(...kids)\n  }\n\n  stack.push(tree)\n  return next()\n}\n\nconst isPromise = p => p && typeof p.then === 'function'\n\nmodule.exports = depth\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,MAAMA,KAAK,GAAG,QAKR;EAAA,IALS;IACbC,KADa;IAEbC,MAFa;IAGbC,WAHa;IAIbC;EAJa,CAKT;EACJ,MAAMC,KAAK,GAAG,EAAd;EACA,MAAMC,IAAI,GAAG,IAAIC,GAAJ,EAAb;;EAEA,MAAMC,IAAI,GAAG,MAAM;IACjB,OAAOH,KAAK,CAACI,MAAb,EAAqB;MACnB,MAAMC,IAAI,GAAGL,KAAK,CAACM,GAAN,EAAb;MACA,MAAMC,GAAG,GAAGC,SAAS,CAACH,IAAD,CAArB;;MACA,IAAII,SAAS,CAACF,GAAD,CAAb,EAAoB;QAClB,OAAOA,GAAG,CAACG,IAAJ,CAAS,MAAMP,IAAI,EAAnB,CAAP;MACD;IACF;;IACD,OAAOF,IAAI,CAACU,GAAL,CAASZ,IAAT,CAAP;EACD,CATD;;EAWA,MAAMS,SAAS,GAAII,SAAD,IAAe;IAC/B,IAAIX,IAAI,CAACY,GAAL,CAASD,SAAT,CAAJ,EAAyB;MACvB,OAAOX,IAAI,CAACU,GAAL,CAASC,SAAT,CAAP;IACD;;IAEDX,IAAI,CAACa,GAAL,CAASF,SAAT,EAAoB,IAApB;IACA,MAAML,GAAG,GAAGX,KAAK,GAAGA,KAAK,CAACgB,SAAD,CAAR,GAAsBA,SAAvC;;IACA,IAAIH,SAAS,CAACF,GAAD,CAAb,EAAoB;MAClB,MAAMQ,UAAU,GAAGR,GAAG,CAACG,IAAJ,CAASM,OAAO,IAAI;QACrCf,IAAI,CAACa,GAAL,CAASF,SAAT,EAAoBI,OAApB;QACA,OAAOC,QAAQ,CAACL,SAAD,CAAf;MACD,CAHkB,CAAnB;MAIAX,IAAI,CAACa,GAAL,CAASF,SAAT,EAAoBG,UAApB;MACA,OAAOA,UAAP;IACD,CAPD,MAOO;MACLd,IAAI,CAACa,GAAL,CAASF,SAAT,EAAoBL,GAApB;MACA,OAAOU,QAAQ,CAACL,SAAD,CAAf;IACD;EACF,CAlBD;;EAoBA,MAAMK,QAAQ,GAAIC,OAAD,IAAa;IAC5B,MAAMC,IAAI,GAAGrB,WAAW,CAACoB,OAAD,EAAUjB,IAAI,CAACU,GAAL,CAASO,OAAT,CAAV,CAAxB;IACA,OAAOT,SAAS,CAACU,IAAD,CAAT,GAAkBA,IAAI,CAACT,IAAL,CAAUU,WAAV,CAAlB,GAA2CA,WAAW,CAACD,IAAD,CAA7D;EACD,CAHD;;EAKA,MAAMC,WAAW,GAAID,IAAD,IAAU;IAC5BA,IAAI,GAAG,CAACA,IAAI,IAAI,EAAT,EAAatB,MAAb,CAAoBA,MAApB,CAAP;IACAG,KAAK,CAACqB,IAAN,CAAW,GAAGF,IAAd;EACD,CAHD;;EAKAnB,KAAK,CAACqB,IAAN,CAAWtB,IAAX;EACA,OAAOI,IAAI,EAAX;AACD,CApDD;;AAsDA,MAAMM,SAAS,GAAGa,CAAC,IAAIA,CAAC,IAAI,OAAOA,CAAC,CAACZ,IAAT,KAAkB,UAA9C;;AAEAa,MAAM,CAACC,OAAP,GAAiB7B,KAAjB"},"metadata":{},"sourceType":"script"}