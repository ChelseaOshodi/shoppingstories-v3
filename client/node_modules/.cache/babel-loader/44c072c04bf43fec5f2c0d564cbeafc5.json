{"ast":null,"code":"const fetch = require('npm-registry-fetch');\n\nconst otplease = require('../utils/otplease.js');\n\nconst npa = require('npm-package-arg');\n\nconst semver = require('semver');\n\nconst getIdentity = require('../utils/get-identity.js');\n\nconst libaccess = require('libnpmaccess');\n\nconst BaseCommand = require('../base-command.js');\n\nclass Deprecate extends BaseCommand {\n  static description = 'Deprecate a version of a package';\n  static name = 'deprecate';\n  static usage = ['<package-spec> <message>'];\n  static params = ['registry', 'otp'];\n  static ignoreImplicitWorkspace = false;\n\n  async completion(opts) {\n    if (opts.conf.argv.remain.length > 1) {\n      return [];\n    }\n\n    const username = await getIdentity(this.npm, this.npm.flatOptions);\n    const packages = await libaccess.lsPackages(username, this.npm.flatOptions);\n    return Object.keys(packages).filter(name => packages[name] === 'read-write' && (opts.conf.argv.remain.length === 0 || name.startsWith(opts.conf.argv.remain[0])));\n  }\n\n  async exec(_ref) {\n    let [pkg, msg] = _ref;\n\n    // msg == null because '' is a valid value, it indicates undeprecate\n    if (!pkg || msg == null) {\n      throw this.usageError();\n    } // fetch the data and make sure it exists.\n\n\n    const p = npa(pkg); // npa makes the default spec \"latest\", but for deprecation\n    // \"*\" is the appropriate default.\n\n    const spec = p.rawSpec === '' ? '*' : p.fetchSpec;\n\n    if (semver.validRange(spec, true) === null) {\n      throw new Error(`invalid version range: ${spec}`);\n    }\n\n    const uri = '/' + p.escapedName;\n    const packument = await fetch.json(uri, { ...this.npm.flatOptions,\n      spec: p,\n      query: {\n        write: true\n      }\n    });\n    Object.keys(packument.versions).filter(v => semver.satisfies(v, spec, {\n      includePrerelease: true\n    })).forEach(v => {\n      packument.versions[v].deprecated = msg;\n    });\n    return otplease(this.npm, this.npm.flatOptions, opts => fetch(uri, { ...opts,\n      spec: p,\n      method: 'PUT',\n      body: packument,\n      ignoreBody: true\n    }));\n  }\n\n}\n\nmodule.exports = Deprecate;","map":{"version":3,"names":["fetch","require","otplease","npa","semver","getIdentity","libaccess","BaseCommand","Deprecate","description","name","usage","params","ignoreImplicitWorkspace","completion","opts","conf","argv","remain","length","username","npm","flatOptions","packages","lsPackages","Object","keys","filter","startsWith","exec","pkg","msg","usageError","p","spec","rawSpec","fetchSpec","validRange","Error","uri","escapedName","packument","json","query","write","versions","v","satisfies","includePrerelease","forEach","deprecated","method","body","ignoreBody","module","exports"],"sources":["/Users/chelsea/Documents/0_AllCoding/shoppingstories-v3/node_modules/npm/lib/commands/deprecate.js"],"sourcesContent":["const fetch = require('npm-registry-fetch')\nconst otplease = require('../utils/otplease.js')\nconst npa = require('npm-package-arg')\nconst semver = require('semver')\nconst getIdentity = require('../utils/get-identity.js')\nconst libaccess = require('libnpmaccess')\nconst BaseCommand = require('../base-command.js')\n\nclass Deprecate extends BaseCommand {\n  static description = 'Deprecate a version of a package'\n  static name = 'deprecate'\n  static usage = ['<package-spec> <message>']\n  static params = [\n    'registry',\n    'otp',\n  ]\n\n  static ignoreImplicitWorkspace = false\n\n  async completion (opts) {\n    if (opts.conf.argv.remain.length > 1) {\n      return []\n    }\n\n    const username = await getIdentity(this.npm, this.npm.flatOptions)\n    const packages = await libaccess.lsPackages(username, this.npm.flatOptions)\n    return Object.keys(packages)\n      .filter((name) =>\n        packages[name] === 'read-write' &&\n        (opts.conf.argv.remain.length === 0 ||\n          name.startsWith(opts.conf.argv.remain[0])))\n  }\n\n  async exec ([pkg, msg]) {\n    // msg == null because '' is a valid value, it indicates undeprecate\n    if (!pkg || msg == null) {\n      throw this.usageError()\n    }\n\n    // fetch the data and make sure it exists.\n    const p = npa(pkg)\n    // npa makes the default spec \"latest\", but for deprecation\n    // \"*\" is the appropriate default.\n    const spec = p.rawSpec === '' ? '*' : p.fetchSpec\n\n    if (semver.validRange(spec, true) === null) {\n      throw new Error(`invalid version range: ${spec}`)\n    }\n\n    const uri = '/' + p.escapedName\n    const packument = await fetch.json(uri, {\n      ...this.npm.flatOptions,\n      spec: p,\n      query: { write: true },\n    })\n\n    Object.keys(packument.versions)\n      .filter(v => semver.satisfies(v, spec, { includePrerelease: true }))\n      .forEach(v => {\n        packument.versions[v].deprecated = msg\n      })\n\n    return otplease(this.npm, this.npm.flatOptions, opts => fetch(uri, {\n      ...opts,\n      spec: p,\n      method: 'PUT',\n      body: packument,\n      ignoreBody: true,\n    }))\n  }\n}\n\nmodule.exports = Deprecate\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}