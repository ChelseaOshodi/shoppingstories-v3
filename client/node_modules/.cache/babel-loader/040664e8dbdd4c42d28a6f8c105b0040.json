{"ast":null,"code":"// npm edit <pkg>\n// open the package folder in the $EDITOR\nconst {\n  resolve\n} = require('path');\n\nconst fs = require('graceful-fs');\n\nconst cp = require('child_process');\n\nconst completion = require('../utils/completion/installed-shallow.js');\n\nconst BaseCommand = require('../base-command.js');\n\nconst splitPackageNames = path => {\n  return path.split('/') // combine scoped parts\n  .reduce((parts, part) => {\n    if (parts.length === 0) {\n      return [part];\n    }\n\n    const lastPart = parts[parts.length - 1]; // check if previous part is the first part of a scoped package\n\n    if (lastPart[0] === '@' && !lastPart.includes('/')) {\n      parts[parts.length - 1] += '/' + part;\n    } else {\n      parts.push(part);\n    }\n\n    return parts;\n  }, []).join('/node_modules/').replace(/(\\/node_modules)+/, '/node_modules');\n};\n\nclass Edit extends BaseCommand {\n  static description = 'Edit an installed package';\n  static name = 'edit';\n  static usage = ['<pkg>[/<subpkg>...]'];\n  static params = ['editor'];\n  static ignoreImplicitWorkspace = false; // TODO\n\n  /* istanbul ignore next */\n\n  async completion(opts) {\n    return completion(this.npm, opts);\n  }\n\n  async exec(args) {\n    if (args.length !== 1) {\n      throw this.usageError();\n    }\n\n    const path = splitPackageNames(args[0]);\n    const dir = resolve(this.npm.dir, path); // graceful-fs does not promisify\n\n    await new Promise((resolve, reject) => {\n      fs.lstat(dir, err => {\n        if (err) {\n          return reject(err);\n        }\n\n        const [bin, ...args] = this.npm.config.get('editor').split(/\\s+/);\n        const editor = cp.spawn(bin, [...args, dir], {\n          stdio: 'inherit'\n        });\n        editor.on('exit', code => {\n          if (code) {\n            return reject(new Error(`editor process exited with code: ${code}`));\n          }\n\n          this.npm.exec('rebuild', [dir]).catch(reject).then(resolve);\n        });\n      });\n    });\n  }\n\n}\n\nmodule.exports = Edit;","map":{"version":3,"names":["resolve","require","fs","cp","completion","BaseCommand","splitPackageNames","path","split","reduce","parts","part","length","lastPart","includes","push","join","replace","Edit","description","name","usage","params","ignoreImplicitWorkspace","opts","npm","exec","args","usageError","dir","Promise","reject","lstat","err","bin","config","get","editor","spawn","stdio","on","code","Error","catch","then","module","exports"],"sources":["/Users/chelsea/Documents/0_AllCoding/shoppingstories-v3/node_modules/npm/lib/commands/edit.js"],"sourcesContent":["// npm edit <pkg>\n// open the package folder in the $EDITOR\n\nconst { resolve } = require('path')\nconst fs = require('graceful-fs')\nconst cp = require('child_process')\nconst completion = require('../utils/completion/installed-shallow.js')\nconst BaseCommand = require('../base-command.js')\n\nconst splitPackageNames = (path) => {\n  return path.split('/')\n    // combine scoped parts\n    .reduce((parts, part) => {\n      if (parts.length === 0) {\n        return [part]\n      }\n\n      const lastPart = parts[parts.length - 1]\n      // check if previous part is the first part of a scoped package\n      if (lastPart[0] === '@' && !lastPart.includes('/')) {\n        parts[parts.length - 1] += '/' + part\n      } else {\n        parts.push(part)\n      }\n\n      return parts\n    }, [])\n    .join('/node_modules/')\n    .replace(/(\\/node_modules)+/, '/node_modules')\n}\n\nclass Edit extends BaseCommand {\n  static description = 'Edit an installed package'\n  static name = 'edit'\n  static usage = ['<pkg>[/<subpkg>...]']\n  static params = ['editor']\n  static ignoreImplicitWorkspace = false\n\n  // TODO\n  /* istanbul ignore next */\n  async completion (opts) {\n    return completion(this.npm, opts)\n  }\n\n  async exec (args) {\n    if (args.length !== 1) {\n      throw this.usageError()\n    }\n\n    const path = splitPackageNames(args[0])\n    const dir = resolve(this.npm.dir, path)\n\n    // graceful-fs does not promisify\n    await new Promise((resolve, reject) => {\n      fs.lstat(dir, (err) => {\n        if (err) {\n          return reject(err)\n        }\n        const [bin, ...args] = this.npm.config.get('editor').split(/\\s+/)\n        const editor = cp.spawn(bin, [...args, dir], { stdio: 'inherit' })\n        editor.on('exit', (code) => {\n          if (code) {\n            return reject(new Error(`editor process exited with code: ${code}`))\n          }\n          this.npm.exec('rebuild', [dir]).catch(reject).then(resolve)\n        })\n      })\n    })\n  }\n}\nmodule.exports = Edit\n"],"mappings":"AAAA;AACA;AAEA,MAAM;EAAEA;AAAF,IAAcC,OAAO,CAAC,MAAD,CAA3B;;AACA,MAAMC,EAAE,GAAGD,OAAO,CAAC,aAAD,CAAlB;;AACA,MAAME,EAAE,GAAGF,OAAO,CAAC,eAAD,CAAlB;;AACA,MAAMG,UAAU,GAAGH,OAAO,CAAC,0CAAD,CAA1B;;AACA,MAAMI,WAAW,GAAGJ,OAAO,CAAC,oBAAD,CAA3B;;AAEA,MAAMK,iBAAiB,GAAIC,IAAD,IAAU;EAClC,OAAOA,IAAI,CAACC,KAAL,CAAW,GAAX,EACL;EADK,CAEJC,MAFI,CAEG,CAACC,KAAD,EAAQC,IAAR,KAAiB;IACvB,IAAID,KAAK,CAACE,MAAN,KAAiB,CAArB,EAAwB;MACtB,OAAO,CAACD,IAAD,CAAP;IACD;;IAED,MAAME,QAAQ,GAAGH,KAAK,CAACA,KAAK,CAACE,MAAN,GAAe,CAAhB,CAAtB,CALuB,CAMvB;;IACA,IAAIC,QAAQ,CAAC,CAAD,CAAR,KAAgB,GAAhB,IAAuB,CAACA,QAAQ,CAACC,QAAT,CAAkB,GAAlB,CAA5B,EAAoD;MAClDJ,KAAK,CAACA,KAAK,CAACE,MAAN,GAAe,CAAhB,CAAL,IAA2B,MAAMD,IAAjC;IACD,CAFD,MAEO;MACLD,KAAK,CAACK,IAAN,CAAWJ,IAAX;IACD;;IAED,OAAOD,KAAP;EACD,CAhBI,EAgBF,EAhBE,EAiBJM,IAjBI,CAiBC,gBAjBD,EAkBJC,OAlBI,CAkBI,mBAlBJ,EAkByB,eAlBzB,CAAP;AAmBD,CApBD;;AAsBA,MAAMC,IAAN,SAAmBb,WAAnB,CAA+B;EACX,OAAXc,WAAW,GAAG,2BAAH;EACP,OAAJC,IAAI,GAAG,MAAH;EACC,OAALC,KAAK,GAAG,CAAC,qBAAD,CAAH;EACC,OAANC,MAAM,GAAG,CAAC,QAAD,CAAH;EACiB,OAAvBC,uBAAuB,GAAG,KAAH,CALD,CAO7B;;EACA;;EACgB,MAAVnB,UAAU,CAAEoB,IAAF,EAAQ;IACtB,OAAOpB,UAAU,CAAC,KAAKqB,GAAN,EAAWD,IAAX,CAAjB;EACD;;EAES,MAAJE,IAAI,CAAEC,IAAF,EAAQ;IAChB,IAAIA,IAAI,CAACf,MAAL,KAAgB,CAApB,EAAuB;MACrB,MAAM,KAAKgB,UAAL,EAAN;IACD;;IAED,MAAMrB,IAAI,GAAGD,iBAAiB,CAACqB,IAAI,CAAC,CAAD,CAAL,CAA9B;IACA,MAAME,GAAG,GAAG7B,OAAO,CAAC,KAAKyB,GAAL,CAASI,GAAV,EAAetB,IAAf,CAAnB,CANgB,CAQhB;;IACA,MAAM,IAAIuB,OAAJ,CAAY,CAAC9B,OAAD,EAAU+B,MAAV,KAAqB;MACrC7B,EAAE,CAAC8B,KAAH,CAASH,GAAT,EAAeI,GAAD,IAAS;QACrB,IAAIA,GAAJ,EAAS;UACP,OAAOF,MAAM,CAACE,GAAD,CAAb;QACD;;QACD,MAAM,CAACC,GAAD,EAAM,GAAGP,IAAT,IAAiB,KAAKF,GAAL,CAASU,MAAT,CAAgBC,GAAhB,CAAoB,QAApB,EAA8B5B,KAA9B,CAAoC,KAApC,CAAvB;QACA,MAAM6B,MAAM,GAAGlC,EAAE,CAACmC,KAAH,CAASJ,GAAT,EAAc,CAAC,GAAGP,IAAJ,EAAUE,GAAV,CAAd,EAA8B;UAAEU,KAAK,EAAE;QAAT,CAA9B,CAAf;QACAF,MAAM,CAACG,EAAP,CAAU,MAAV,EAAmBC,IAAD,IAAU;UAC1B,IAAIA,IAAJ,EAAU;YACR,OAAOV,MAAM,CAAC,IAAIW,KAAJ,CAAW,oCAAmCD,IAAK,EAAnD,CAAD,CAAb;UACD;;UACD,KAAKhB,GAAL,CAASC,IAAT,CAAc,SAAd,EAAyB,CAACG,GAAD,CAAzB,EAAgCc,KAAhC,CAAsCZ,MAAtC,EAA8Ca,IAA9C,CAAmD5C,OAAnD;QACD,CALD;MAMD,CAZD;IAaD,CAdK,CAAN;EAeD;;AArC4B;;AAuC/B6C,MAAM,CAACC,OAAP,GAAiB5B,IAAjB"},"metadata":{},"sourceType":"script"}